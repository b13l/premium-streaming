<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo Premium</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
            background:#0a0a0a;
            color:#d4af37;
            min-height:100vh;
            padding:20px;
        }
        .header { text-align:center; margin-bottom:30px; }
        .header h1 {
            color:#d4af37;
            font-size:2em;
            text-shadow:0 0 20px rgba(212,175,55,0.5);
            margin-bottom:10px;
        }
        .header p { color:#b8860b; }

        .admin-pin {
            background:linear-gradient(135deg,#00ff00 0%,#00cc00 100%);
            color:#0a0a0a;
            padding:20px;
            border-radius:10px;
            text-align:center;
            margin-bottom:20px;
            font-weight:bold;
            font-size:1.2em;
            box-shadow:0 0 20px rgba(0,255,0,0.4);
        }

        .info-box {
            background:rgba(0,212,255,0.1);
            border:2px solid #00d4ff;
            color:#00d4ff;
            padding:15px;
            border-radius:8px;
            margin-bottom:20px;
            text-align:center;
        }

        .tabs {
            display:flex;
            gap:10px;
            margin-bottom:30px;
            flex-wrap:wrap;
        }
        .tab-btn {
            background:rgba(212,175,55,0.1);
            border:2px solid #d4af37;
            color:#d4af37;
            padding:12px 25px;
            border-radius:8px;
            cursor:pointer;
            font-weight:bold;
            transition:all 0.3s;
        }
        .tab-btn:hover { background:#d4af37;color:#0a0a0a; }
        .tab-btn.active {
            background:#d4af37;
            color:#0a0a0a;
            box-shadow:0 0 20px rgba(212,175,55,0.6);
        }

        .tab-content { display:none; }
        .tab-content.active { display:block; }

        .status-bar {
            display:grid;
            grid-template-columns:repeat(3,1fr);
            gap:20px;
            margin-bottom:30px;
        }
        .status-card {
            background:linear-gradient(135deg,#1a1a1a 0%,#2d2d2d 100%);
            padding:20px;
            border-radius:10px;
            border:2px solid #d4af37;
            text-align:center;
        }
        .status-card h3 {
            color:#b8860b;
            font-size:0.9em;
            margin-bottom:10px;
        }
        .status-card .number {
            color:#d4af37;
            font-size:2.5em;
            font-weight:bold;
        }

        .services-grid {
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
            gap:20px;
        }
        .service-card {
            background:linear-gradient(135deg,#1a1a1a 0%,#2d2d2d 100%);
            padding:20px;
            border-radius:10px;
            border:2px solid #d4af37;
        }
        .service-header {
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:15px;
            padding-bottom:15px;
            border-bottom:2px solid #d4af37;
        }
        .service-name {
            color:#d4af37;
            font-weight:bold;
            font-size:1.2em;
        }
        .service-count {
            background:#d4af37;
            color:#0a0a0a;
            padding:5px 12px;
            border-radius:15px;
            font-weight:bold;
        }

        .accounts-input {
            background:#0a0a0a;
            border:2px solid #00d4ff;
            color:#00d4ff;
            padding:12px;
            border-radius:8px;
            width:100%;
            margin-bottom:10px;
            font-family:monospace;
            min-height:100px;
            resize:vertical;
        }

        .btn {
            background:linear-gradient(135deg,#d4af37 0%,#f0c843 100%);
            color:#0a0a0a;
            border:none;
            padding:12px 20px;
            border-radius:8px;
            cursor:pointer;
            font-weight:bold;
            transition:all 0.3s;
            width:100%;
        }
        .btn:hover { transform:scale(1.02); }
        .btn-secondary { background:#ff4444;color:#fff; }
        .btn-secondary:hover { background:#ff5555; }
        .btn-delete { background:#ff6b6b;color:#fff;margin-top:10px; }
        .btn-delete:hover { background:#ff7f7f; }

        .btn-group { display:flex; gap:10px; }
        .btn-group .btn { flex:1; }
        .btn-group .btn-delete { margin-top:0; }

        .add-service-section {
            background:rgba(212,175,55,0.1);
            padding:20px;
            border-radius:10px;
            border:2px solid #d4af37;
            margin-bottom:20px;
        }

        .form-group { margin-bottom:15px; }
        .form-group label {
            display:block;
            color:#d4af37;
            margin-bottom:8px;
            font-weight:bold;
        }
        .form-group input {
            width:100%;
            padding:12px;
            background:#0a0a0a;
            border:2px solid #d4af37;
            color:#d4af37;
            border-radius:8px;
            font-size:1em;
        }
        .form-group input:focus {
            outline:none;
            border-color:#f0c843;
            box-shadow:0 0 15px rgba(240,200,67,0.3);
        }

        .purchases-list {
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
            gap:20px;
        }
        .purchase-card {
            background:linear-gradient(135deg,#1a3a1a 0%,#2d4d2d 100%);
            padding:20px;
            border-radius:10px;
            border:2px solid #4caf50;
        }
        .purchase-header {
            color:#4caf50;
            font-weight:bold;
            margin-bottom:10px;
            display:flex;
            justify-content:space-between;
        }
        .purchase-info {
            color:#b8860b;
            font-size:0.9em;
            margin-bottom:8px;
        }

        @media (max-width:768px) {
            .status-bar { grid-template-columns:1fr; }
            .services-grid { grid-template-columns:1fr; }
            .tabs { flex-direction:column; }
            .tab-btn { width:100%; }
            .btn-group { flex-direction:column; }
        }
    </style>
</head>
<body>
<div class="header">
    <h1>Painel Administrativo Premium</h1>
    <p>Gerencie contas e comprovantes de pagamento</p>
</div>

<div class="admin-pin">
    PIN ATIVO: <strong>633733</strong>
</div>

<div class="info-box">
    Acesso somente ap√≥s aprova√ß√£o manual do comprovante.<br>
    Bloqueie se o comprovante for falso.
</div>

<div id="pendingAlert" class="info-box" style="display:none;border-color:#ffb300;color:#ffb300;">
    Nenhuma compra pendente no momento.
</div>

<div class="tabs">
    <button class="tab-btn active" onclick="switchTab('contas')">Gerenciar Contas</button>
    <button class="tab-btn" onclick="switchTab('compras')">Compras</button>
</div>

<!-- TAB CONTAS -->
<div id="contas" class="tab-content active">
    <div class="add-service-section">
        <h2 style="color:#d4af37;margin-bottom:15px;">Adicionar Novo Servi√ßo</h2>
        <div class="form-group">
            <label>Nome do Servi√ßo</label>
            <input type="text" id="newServiceName" placeholder="Ex: Apple TV, Paramount, etc">
        </div>
        <div class="form-group">
            <label>Emoji/√çcone</label>
            <input type="text" id="newServiceEmoji" placeholder="Ex: üì∫, üé¨, etc" maxlength="2">
        </div>
        <button class="btn" onclick="addNewService()">Adicionar Servi√ßo</button>
    </div>

    <div class="status-bar" id="statusBar"></div>

    <div class="btn-group" style="margin-bottom:15px;">
        <button class="btn" onclick="moveFirstToLast()">Mover primeiro para o fim</button>
        <button class="btn" onclick="moveLastToFirst()">Mover √∫ltimo para o in√≠cio</button>
    </div>

    <div class="services-grid" id="servicesGrid"></div>
</div>

<!-- TAB COMPRAS -->
<div id="compras" class="tab-content">
    <button class="btn btn-delete" onclick="clearAllPurchases()" style="max-width:250px;margin-bottom:15px;">
        Limpar clientes existentes
    </button>
    <div class="purchases-list" id="purchasesList"></div>
</div>

<script>
let services = [
    { id:1, name:"Claro TV",   emoji:"üì∫", accounts:[] },
    { id:2, name:"Globo Play", emoji:"üì∫", accounts:[] },
    { id:3, name:"Sky",        emoji:"üì°", accounts:[] },
    { id:4, name:"HBO Max",    emoji:"üé¨", accounts:[] },
    { id:5, name:"Disney",     emoji:"üßö", accounts:[] },
    { id:6, name:"Prime Video",emoji:"üì¶", accounts:[] }
];

const planDays = {
    "1 M√™s": 30,
    "3 Meses": 90,
    "6 Meses": 180,
    "1 Ano": 365,
    "Vital√≠cio": 36500
};

function init() {
    loadData();
    renderServices();
    renderPurchases();
    window.addEventListener("storage", () => {
        loadData();
        renderServices();
        renderPurchases();
    });
}

function loadData() {
    const saved = localStorage.getItem("adminServices");
    if (saved) services = JSON.parse(saved);
    if (!localStorage.getItem("purchases")) localStorage.setItem("purchases","[]");
}

function saveData() {
    localStorage.setItem("adminServices", JSON.stringify(services));
    const accountsData = {};
    services.forEach(s => accountsData[s.id] = s.accounts || []);
    localStorage.setItem("accountsData", JSON.stringify(accountsData));
}

function switchTab(tabName) {
    document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
    document.querySelectorAll(".tab-btn").forEach(el => el.classList.remove("active"));
    document.getElementById(tabName).classList.add("active");
    event.target.classList.add("active");
}

function addNewService() {
    const name = document.getElementById("newServiceName").value.trim();
    const emoji = document.getElementById("newServiceEmoji").value.trim();
       if (!name || !emoji) {
        alert("Preencha nome e emoji!");
        return;
    }
    const newId = Math.max(...services.map(s => s.id), 0) + 1;
    services.push({ id:newId, name, emoji, accounts:[] });
    saveData();
    document.getElementById("newServiceName").value = "";
    document.getElementById("newServiceEmoji").value = "";
    renderServices();
    alert("Servi√ßo adicionado com sucesso!");
}

function moveFirstToLast() {
    if (services.length <= 1) return;
    const first = services.shift();
    services.push(first);
    saveData();
    renderServices();
}
function moveLastToFirst() {
    if (services.length <= 1) return;
    const last = services.pop();
    services.unshift(last);
    saveData();
    renderServices();
}

function renderServices() {
    const grid = document.getElementById("servicesGrid");
    grid.innerHTML = "";

    const statusBar = document.getElementById("statusBar");
    const totalAccounts = services.reduce((sum,s)=>sum+(s.accounts?s.accounts.length:0),0);
    const activeServices = services.filter(s=>s.accounts && s.accounts.length>0).length;

    statusBar.innerHTML = `
        <div class="status-card">
            <h3>Total de Contas</h3>
            <div class="number">${totalAccounts}</div>
        </div>
        <div class="status-card">
            <h3>Servi√ßos Ativos</h3>
            <div class="number">${activeServices}</div>
        </div>
        <div class="status-card">
            <h3>Compras Ativas</h3>
            <div class="number" id="activePurchases">0</div>
        </div>`;

    const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");
    const activePurchases = purchases.filter(p => p.status === "approved").length;
    document.getElementById("activePurchases").textContent = activePurchases;

    services.forEach(service => {
        const card = document.createElement("div");
        card.className = "service-card";
        card.innerHTML = `
            <div class="service-header">
                <span>
                    <span style="font-size:1.5em;margin-right:10px;">${service.emoji}</span>
                    <span class="service-name">${service.name}</span>
                </span>
                <span class="service-count">${service.accounts ? service.accounts.length : 0}</span>
            </div>
            <textarea class="accounts-input" id="service-${service.id}"
                      placeholder="Cole as contas aqui (usuario:senha)\nUma conta por linha">${
                        service.accounts ? service.accounts.map(a=>`${a.usuario}:${a.senha}`).join("\n") : ""
                      }</textarea>
            <div class="btn-group">
                <button class="btn" onclick="saveServiceAccounts(${service.id})">Salvar</button>
                <button class="btn btn-delete" onclick="deleteService(${service.id})">Deletar</button>
            </div>`;
        grid.appendChild(card);
    });
}

function saveServiceAccounts(serviceId) {
    const textarea = document.getElementById(`service-${serviceId}`);
    if (!textarea) return;
    const text = textarea.value.trim();
    const accounts = [];
    if (text) {
        const lines = text.split("\n");
        lines.forEach(line => {
            line = line.trim();
            if (!line || !line.includes(":")) return;
            const parts = line.split(":");
            if (parts.length < 2) return;
            const usuario = parts[0].trim();
            const senha   = parts.slice(1).join(":").trim();
            if (usuario && senha) accounts.push({usuario,senha});
        });
    }
    const service = services.find(s => s.id === serviceId);
    if (service) service.accounts = accounts;
    saveData();
    renderServices();
    alert(`${accounts.length} contas salvas com sucesso!`);
}

function deleteService(serviceId) {
    const service = services.find(s => s.id === serviceId);
    if (!service) return;
    if (!confirm(`Tem certeza que quer deletar ${service.name}?`)) return;
    services = services.filter(s => s.id !== serviceId);
    saveData();
    renderServices();
    alert("Servi√ßo deletado com sucesso!");
}

function renderPurchases() {
    const container = document.getElementById("purchasesList");
    const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");

    const pendingCount = purchases.filter(p => p.status === "pending").length;
    const pendingAlert = document.getElementById("pendingAlert");
    if (pendingAlert) {
        if (pendingCount > 0) {
            pendingAlert.style.display = "block";
            pendingAlert.textContent = `‚ö† Existem ${pendingCount} compra(s) pendente(s) de an√°lise. Abra a aba "Compras".`;
        } else {
            pendingAlert.style.display = "none";
        }
    }

    if (!purchases || purchases.length === 0) {
        container.innerHTML = `<p style="color:#888;grid-column:1/-1;text-align:center;padding:30px;">Nenhuma compra registrada</p>`;
        return;
    }
    container.innerHTML = purchases.map((p,idx) => `
        <div class="purchase-card">
            <div class="purchase-header">
                <span>${p.planName}</span>
                <span style="color:#4caf50;">${p.pin || "Aguardando PIN"}</span>
            </div>
            <div class="purchase-info">${p.planPrice}</div>
            <div class="purchase-info">Cliente: ${p.payerName || "‚Äî"}</div>
            <div class="purchase-info">Email: ${p.clientEmail || "‚Äî"}</div>
            <div class="purchase-info">WhatsApp: ${p.clientWhatsapp || "‚Äî"}</div>
            <div class="purchase-info">Data: ${p.purchaseDate || "‚Äî"}</div>
            <div class="purchase-info">Expira: ${p.expiryDate || "‚Äî"}</div>
            <div class="purchase-info">
                Status:
                <span style="color:${
                    p.status === "approved" ? "#4caf50" :
                    p.status === "pending"  ? "#ffb300" :
                    "#ff4444"
                };">${p.status.toUpperCase()}</span>
            </div>
            ${
                p.status === "pending"
                  ? `
                    <button class="btn" onclick="approvePurchase(${idx})">Aprovar</button>
                    <button class="btn btn-secondary" onclick="rejectPurchase(${idx})">Rejeitar</button>
                    `
                  : p.status === "approved"
                  ? `<button class="btn btn-secondary" onclick="blockPurchase(${idx})">Bloquear Comprovante Falso</button>`
                  : ""
            }
        </div>`).join("");
}

function approvePurchase(index) {
    const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");
    const p = purchases[index];
    if (!p || p.status !== "pending") return;
    if (!confirm(`Aprovar compra de ${p.payerName || "cliente"} (${p.planName})?`)) return;

    const randomPin = String(Math.floor(Math.random()*1000000)).padStart(6,"0");
    const now = new Date();
    let daysToAdd = planDays[p.planName] || 30;
    const expiryDate = new Date(now.getTime() + daysToAdd*24*60*60*1000);

    p.pin = randomPin;
    p.purchaseDate = now.toLocaleString("pt-BR");
    p.expiryDate = expiryDate.toLocaleString("pt-BR");
    p.daysRemaining = daysToAdd === 36500 ? 999999 : daysToAdd;
    p.status = "approved";

    localStorage.setItem("purchases", JSON.stringify(purchases));
    renderPurchases();
    renderServices();
    alert(`Compra aprovada! PIN do cliente: ${randomPin}\n\nCopie e envie por email ou WhatsApp.`);
}

function rejectPurchase(index) {
    const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");
    const p = purchases[index];
    if (!p) return;
    if (!confirm("Rejeitar esta comprova√ß√£o de pagamento?")) return;
    p.status = "rejected";
    localStorage.setItem("purchases", JSON.stringify(purchases));
    renderPurchases();
    renderServices();
}

function blockPurchase(index) {
    if (!confirm("Tem certeza que quer bloquear este PIN?")) return;
    const purchases = JSON.parse(localStorage.getItem("purchases") || "[]");
    if (!purchases[index]) return;
    purchases[index].status = "blocked";
    localStorage.setItem("purchases", JSON.stringify(purchases));
    renderPurchases();
    renderServices();
    alert("PIN bloqueado!");
}

function clearAllPurchases() {
    if (!confirm("Tem certeza que deseja limpar todos os clientes existentes em compras?")) return;
    localStorage.setItem("purchases","[]");
    renderPurchases();
    renderServices();
    alert("Clientes existentes em compras foram limpos com sucesso!");
}

init();
</script>
</body>
</html>
